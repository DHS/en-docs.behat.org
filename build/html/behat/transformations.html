

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Step Argument Transformations &mdash; Behat v1.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/scrolls.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/behat.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lobster" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="Behat v1.1.0 documentation" href="../index.html" />
    <link rel="next" title="Formatters" href="formatters.html" />
    <link rel="prev" title="Calling Steps from Step Definitions" href="step_to_step_calls.html" /> 
  </head>
  <body>
    <header>
        <a id="logo" href="http://behat.org">Behat</a>
        <nav>
            <ul>
                <li><a href="http://behat.org">main</a></li>
                <li class="active"><a href="http://docs.behat.org">docs</a></li>
                <li><a href="http://pear.behat.org">pear</a></li>
                <li><a href="https://github.com/Behat">github</a></li>
            </ul>
        </nav>
    </header>

    <section class="docs">

        <nav class="toc">
            <h3>Navigation</h3>
            <ul class="nav">
                <li><a href="../index.html">Behat Documentation</a></li>
                    <li><a href="step_to_step_calls.html">Calling Steps from Step Definitions</a> (prev)</li>
                    <li>
                        <a href="#">
                            Step Argument Transformations
                        </a> (cur)
                    </li>
                    <li><a href="formatters.html">Formatters</a> (next)</li>
            </ul>

            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference internal" href="#">Step Argument Transformations</a><ul>
<li><a class="reference internal" href="#transforming-tables">Transforming tables</a></li>
</ul>
</li>
</ul>

        </nav>

        <section class="documentation">
            
  <div class="section" id="step-argument-transformations">
<h1>Step Argument Transformations<a class="headerlink" href="#step-argument-transformations" title="Permalink to this headline">¶</a></h1>
<p>Step argument transformations help your step definitions be more DRY. You can use the <tt class="docutils literal"><span class="pre">$steps-&gt;Transform</span></tt> method to register a regular expression along with a callback. Before captured Regexp groups get passed as arguments to step definitions, an attempt is made to match them against any registered <tt class="docutils literal"><span class="pre">Transform</span></tt>. If there is a match, the return value of the callback supplied with the transform is passed as the step definition argument instead.</p>
<p>It’s recommended that you put <tt class="docutils literal"><span class="pre">Transform</span></tt> code in the same file as the step definitions using them. It becomes easier to navigate your code that way. Here is an example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/steps/trans_steps.php</span>

<span class="nv">$steps</span><span class="o">-&gt;</span><span class="na">Transform</span><span class="p">(</span><span class="s1">&#39;/^user \w+$/&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/\w+$/&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nv">$steps</span><span class="o">-&gt;</span><span class="na">Then</span><span class="p">(</span><span class="s1">&#39;/^(user \w+) should be friends with (user \w+)$/&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$friend</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assertTrue</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isFriendOf</span><span class="p">(</span><span class="nv">$friend</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-gherkin"><div class="highlight"><pre><span class="k">Feature:</span><span class="nf"></span>

<span class="nf">    </span><span class="k">Scenario:</span><span class="nf"> befriending</span>
<span class="k">      Given </span><span class="nf">...</span>
<span class="nf">      </span><span class="k">When </span><span class="nf">...</span>
<span class="nf">      </span><span class="k">Then </span><span class="nf">user larrytheliquid should be friends with user dastels</span>
</pre></div>
</div>
<p>Note that sometimes you may not need to parse the entire arg and may only care about a specific Regexp capture group being matched. For this more common case, you can use an optional syntax for Transform where the block supplied has arguments that correspond to capture groups in the registered Regexp:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/steps/trans_steps.php</span>

<span class="nv">$steps</span><span class="o">-&gt;</span><span class="na">Transform</span><span class="p">(</span><span class="s1">&#39;/^user (\w+)$/&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$username</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="section" id="transforming-tables">
<h2>Transforming tables<a class="headerlink" href="#transforming-tables" title="Permalink to this headline">¶</a></h2>
<p>Step argument transformations can also be used with tables. A table is matched via a comma-delimited list of the column headers and the ‘table:’ prefix:</p>
<div class="highlight-gherkin"><div class="highlight"><pre><span class="k">Feature:</span><span class="nf"></span>

<span class="nf">    </span><span class="k">Scenario:</span><span class="nf"> setting up via table</span>
<span class="k">      Given </span><span class="nf">...</span>
<span class="nf">      </span><span class="k">When </span><span class="nf">...</span>
<span class="nf">      </span><span class="k">Then </span><span class="nf">I should have</span>
<span class="k">        |</span><span class="s"> name</span><span class="k">  |</span><span class="s"> age</span><span class="k"> |</span><span class="nf"></span>
<span class="k">        |</span><span class="s"> corey</span><span class="k"> |</span><span class="s"> 36</span><span class="k">  |</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/steps/trans_steps.php</span>

<span class="nv">$steps</span><span class="o">-&gt;</span><span class="na">Transform</span><span class="p">(</span><span class="s1">&#39;/^table:name,age$/&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">getHash</span><span class="p">()</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>


        </section>

        <footer>
            <nav>
                    &laquo; <a href="step_to_step_calls.html">Calling Steps from Step Definitions</a> |
                    <a href="#">
                        Step Argument Transformations
                    </a>
                    | <a href="formatters.html">Formatters</a> &raquo;
            </nav>
        </footer>

    </section>

    <footer>
        <dl>
            <dt>Docs</dt>
            <dd><a href="http://docs.behat.org/en/quick_intro.html">Quick Intro</a></dd>
            <dd><a href="http://docs.behat.org/en/index.html">Behat</a></dd>
            <dd><a href="http://docs.behat.org/api/gherkin/index.html">Gherkin API</a></dd>
            <dd><a href="http://docs.behat.org/api/behat/index.html">Behat API</a></dd>
        </dl>
        <dl>
            <dt>Plugins</dt>
            <dd><a href="http://symfony2bundles.org/Behat/BehatBundle">BehatBundle</a></dd>
            <dd><a href="https://github.com/Behat/sfBehatPlugin">sfBehatPlugin</a></dd>
        </dl>
        <dl>
            <dt>Pear</dt>
            <dd><a href="http://pear.everzet.com/">Gherkin</a></dd>
            <dd><a href="http://pear.everzet.com/">Behat</a></dd>
        </dl>
        <dl>
            <dt>GitHub</dt>
            <dd><a href="https://github.com/Behat/Gherkin">Gherkin</a></dd>
            <dd><a href="https://github.com/Behat/Behat">Behat</a></dd>
        </dl>

        <div class="clear"></div>

        <div class="sponsor">
            <span>sponsored by</span>
            <a class="knp" href="http://www.knplabs.com">knpLabs, Symfony developers</a>
        </div>
    </footer>

  </body>
</html>