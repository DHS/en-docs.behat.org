

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Hooks &mdash; Behat v1.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/scrolls.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/behat.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lobster" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="Behat v1.1.0 documentation" href="../index.html" />
    <link rel="next" title="Calling Steps from Step Definitions" href="step_to_step_calls.html" />
    <link rel="prev" title="Tags" href="../gherkin/tags.html" /> 
  </head>
  <body>
    <header>
        <a id="logo" href="http://behat.org">Behat</a>
        <nav>
            <ul>
                <li><a href="http://behat.org">main</a></li>
                <li class="active"><a href="http://docs.behat.org">docs</a></li>
                <li><a href="http://pear.behat.org">pear</a></li>
                <li><a href="https://github.com/Behat">github</a></li>
            </ul>
        </nav>
    </header>

    <section class="docs">

        <nav class="toc">
            <h3>Navigation</h3>
            <ul class="nav">
                <li><a href="../index.html">Behat Documentation</a></li>
                    <li><a href="../gherkin/tags.html">Tags</a> (prev)</li>
                    <li>
                        <a href="#">
                            Hooks
                        </a> (cur)
                    </li>
                    <li><a href="step_to_step_calls.html">Calling Steps from Step Definitions</a> (next)</li>
            </ul>

            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference internal" href="#">Hooks</a><ul>
<li><a class="reference internal" href="#suite-hooks">Suite Hooks</a></li>
<li><a class="reference internal" href="#feature-hooks">Feature Hooks</a></li>
<li><a class="reference internal" href="#scenario-hooks">Scenario Hooks</a></li>
<li><a class="reference internal" href="#step-hooks">Step Hooks</a></li>
</ul>
</li>
</ul>

        </nav>

        <section class="documentation">
            
  <div class="section" id="hooks">
<h1>Hooks<a class="headerlink" href="#hooks" title="Permalink to this headline">¶</a></h1>
<p>Behat provides a number of hooks which allow to run functions at various points in the Behat test cycle. You can put them in your <tt class="docutils literal"><span class="pre">features/support/hooks.php</span></tt> file. There is no association between where the hook is defined and which scenario/step it is run for, but you can use tagged hooks (see below) if you want more fine grained control.</p>
<div class="section" id="suite-hooks">
<h2>Suite Hooks<a class="headerlink" href="#suite-hooks" title="Permalink to this headline">¶</a></h2>
<p>These hooks are executed before and after a whole suite. It&#8217;s best place to write project-wide tear up and tear down actions:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">beforeSuite</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something before whole test suite</span>
<span class="p">});</span>
<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">afterSuite</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something after whole test suite</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Notice, that like for step definitions and environment configs, we have a global <tt class="docutils literal"><span class="pre">$hooks</span></tt> variable here, which represents HookDispatcher object. <tt class="docutils literal"><span class="pre">HookDispatcher</span></tt> is in charge of defining hooks and fireing them at the right time.</p>
<p>Suite hooks (<tt class="docutils literal"><span class="pre">beforeSuite</span></tt> and <tt class="docutils literal"><span class="pre">afterSuite</span></tt>) have a single argument which is the callback, they don&#8217;t use a filter.</p>
<p>Also note the <tt class="docutils literal"><span class="pre">$event</span></tt> argument of the callback. It&#8217;s a <tt class="docutils literal"><span class="pre">Behat\Behat\Event\EventInterface</span></tt> instance. In case of the <tt class="docutils literal"><span class="pre">beforeSuite</span></tt> and <tt class="docutils literal"><span class="pre">afterSuite</span></tt> hooks it would be a <a class="reference external" href="http://docs.behat.org/api/behat/behat/behat/event/suiteevent.html">SuiteEvent</a> object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">afterSuite</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$dataCollector</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getLogger</span><span class="p">();</span>

    <span class="c1">// do something with information from dataCollector</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="feature-hooks">
<h2>Feature Hooks<a class="headerlink" href="#feature-hooks" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">beforeFeature</span></tt> hooks are executed before each feature of the test suite:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">beforeFeature</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something before each feature</span>
<span class="p">});</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">afterFeature</span></tt> hooks are executed after each feature of the test suite:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">afterFeature</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something after each feature</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Notice the additional empty first argument to this hook type. This is a filter. You can put there any of your <tt class="docutils literal"><span class="pre">--name</span></tt> or <tt class="docutils literal"><span class="pre">--tags</span></tt> filters and that hook will be executed for features matching this filter only.</p>
<p><tt class="docutils literal"><span class="pre">$event</span></tt> is an instance of <a class="reference external" href="http://docs.behat.org/api/behat/behat/behat/event/featureevent.html">FeatureEvent</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">beforeFeature</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$feature</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getFeature</span><span class="p">();</span>
    <span class="nv">$featureTitle</span> <span class="o">=</span> <span class="nv">$feature</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-hooks">
<h2>Scenario Hooks<a class="headerlink" href="#scenario-hooks" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">beforeScenario</span></tt> hooks are executed before the first step of each scenario:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">beforeScenario</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something before each scenario</span>
<span class="p">});</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">afterScenario</span></tt> hooks are executed after the last step of each scenario:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">afterScenario</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something after each scenario</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The first argument is a filter, like with feature hooks.</p>
<p><tt class="docutils literal"><span class="pre">$event</span></tt> is an instance of <a class="reference external" href="http://docs.behat.org/api/behat/behat/behat/event/scenarioevent.html">ScenarioEvent</a> or <a class="reference external" href="http://docs.behat.org/api/behat/behat/behat/event/outlineexampleevent.html">OutlineExampleEvent</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">afterScenario</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// get scenario or outline:</span>
    <span class="nv">$scenario</span> <span class="o">=</span> <span class="nv">$event</span> <span class="nx">instanceof</span> <span class="nx">Behat\Behat\Event\ScenarioEvent</span> <span class="o">?</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getScenario</span><span class="p">()</span> <span class="o">:</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOutline</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Also, there are some interesting getters in the scenario <tt class="docutils literal"><span class="pre">$event</span></tt> objects:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">getEnvironment()</span></tt> - scenario <a class="reference internal" href="environment.html"><em>Environment</em></a> object. This parameter is available in both before &amp; after hooks. It returns the same <a class="reference internal" href="environment.html"><em>Environment</em></a> object that gets passed as <tt class="docutils literal"><span class="pre">$world</span></tt> into every scenario step definition.</li>
<li><tt class="docutils literal"><span class="pre">getResult()</span></tt> - scenario result code (see <tt class="docutils literal"><span class="pre">Behat\Behat\Tester\StepTester</span></tt> code for further information). This parameter is available only in after hooks.</li>
<li><tt class="docutils literal"><span class="pre">isSkipped()</span></tt> - boolean, that marks if the scenario has skipped steps. This parameter is available only in after hooks.</li>
</ul>
</div>
<div class="section" id="step-hooks">
<h2>Step Hooks<a class="headerlink" href="#step-hooks" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">beforeStep</span></tt> hooks are executed before each step:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">beforeStep</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something before each step</span>
<span class="p">});</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">afterStep</span></tt> hooks are executed after each step:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">afterStep</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something after each step</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The first argument is a filter, like with feature hooks.</p>
<p><tt class="docutils literal"><span class="pre">$event</span></tt> is an instance of <a class="reference external" href="http://docs.behat.org/api/behat/behat/behat/event/stepevent.html">StepEvent</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// features/support/hooks.php</span>

<span class="nv">$hooks</span><span class="o">-&gt;</span><span class="na">afterStep</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// get step AST node:</span>
    <span class="nv">$step</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getSubject</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Also, there are some interesting getters in steps <tt class="docutils literal"><span class="pre">$event</span></tt> object:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">getEnvironment()</span></tt> - scenario environment object. This parameter is available in both before &amp; after hooks.</li>
<li><tt class="docutils literal"><span class="pre">getResult()</span></tt> - step result code (see <tt class="docutils literal"><span class="pre">Behat\Behat\Tester\StepTester</span></tt> code for further information). This parameter is available only in after hooks.</li>
<li><tt class="docutils literal"><span class="pre">getException()</span></tt> - exception instance or null. This parameter is available only in after hooks.</li>
<li><tt class="docutils literal"><span class="pre">getDefinition()</span></tt> - matched definition or null. This parameter is available only in after hooks.</li>
<li><tt class="docutils literal"><span class="pre">getSnippet()</span></tt> - snippet for definition if step undefined or null. This parameter is available only in after hooks.</li>
</ul>
</div>
</div>


        </section>

        <footer>
            <nav>
                    &laquo; <a href="../gherkin/tags.html">Tags</a> |
                    <a href="#">
                        Hooks
                    </a>
                    | <a href="step_to_step_calls.html">Calling Steps from Step Definitions</a> &raquo;
            </nav>
        </footer>

    </section>

    <footer>
        <dl>
            <dt>Docs</dt>
            <dd><a href="http://docs.behat.org/en/quick_intro.html">Quick Intro</a></dd>
            <dd><a href="http://docs.behat.org/en/index.html">Behat</a></dd>
            <dd><a href="http://docs.behat.org/api/gherkin/index.html">Gherkin API</a></dd>
            <dd><a href="http://docs.behat.org/api/behat/index.html">Behat API</a></dd>
        </dl>
        <dl>
            <dt>Plugins</dt>
            <dd><a href="http://symfony2bundles.org/Behat/BehatBundle">BehatBundle</a></dd>
            <dd><a href="https://github.com/Behat/sfBehatPlugin">sfBehatPlugin</a></dd>
        </dl>
        <dl>
            <dt>Pear</dt>
            <dd><a href="http://pear.everzet.com/">Gherkin</a></dd>
            <dd><a href="http://pear.everzet.com/">Behat</a></dd>
        </dl>
        <dl>
            <dt>GitHub</dt>
            <dd><a href="https://github.com/Behat/Gherkin">Gherkin</a></dd>
            <dd><a href="https://github.com/Behat/Behat">Behat</a></dd>
        </dl>

        <div class="clear"></div>

        <div class="sponsor">
            <span>sponsored by</span>
            <a class="knp" href="http://www.knplabs.com">knpLabs, Symfony developers</a>
        </div>
    </footer>

  </body>
</html>